<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Meme Generator with Emojis</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --bg-color: #f5f5f5;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            transition: all 0.3s ease;
        }

        body {
            background-color: var(--bg-color);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            min-height: 80vh;
        }

        header {
            background-color: var(--dark-color);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }

        nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        nav ul li a.active {
            background-color: var(--primary-color);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark-color);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Home Page */
        .home-page {
            text-align: center;
            padding: 40px 20px;
        }

        .home-page h2 {
            margin-bottom: 20px;
            color: var(--dark-color);
            font-size: 2.5rem;
        }

        .home-page p {
            margin-bottom: 30px;
            font-size: 1.2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .get-started-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .get-started-btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Editor Page */
        .editor-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .meme-canvas-container {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        #memeCanvas {
            width: 100%;
            max-width: 600px;
            height: auto;
            border: 2px dashed #ccc;
            display: block;
            margin: 0 auto;
            background-color: #f9f9f9;
        }

        .canvas-controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .canvas-controls button, .canvas-controls input {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .canvas-controls button {
            background-color: var(--primary-color);
            color: white;
        }

        .canvas-controls button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .canvas-controls input {
            background-color: var(--light-color);
        }

        .generate-meme-btn {
            background-color: var(--secondary-color) !important;
            font-weight: bold;
        }

        .generate-meme-btn:hover {
            background-color: #27ae60 !important;
        }

        .controls {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .text-controls, .meme-templates, .emoji-controls {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 8px;
        }

        .text-controls h3, .meme-templates h3, .emoji-controls h3 {
            margin-bottom: 15px;
            color: var(--dark-color);
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
        }

        .form-group input[type="range"] {
            padding: 0;
        }

        #applyTextChanges, #removeSelectedText {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #applyTextChanges:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        #removeSelectedText {
            background-color: var(--danger-color);
        }

        #removeSelectedText:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .meme-templates {
            flex: 1;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .template {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .template:hover {
            transform: scale(1.05);
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Emoji Picker */
        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .emoji-btn {
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
        }

        .emoji-btn:hover {
            background-color: #eee;
            transform: scale(1.2);
        }

        /* Gallery Page */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .meme-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
            background-color: white;
        }

        .meme-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .meme-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .meme-item-info {
            padding: 15px;
        }

        .meme-item-info h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .meme-item-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .meme-item-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .download-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .download-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .delete-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        /* Navigation buttons */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .prev-btn {
            background-color: #f39c12;
            color: white;
        }

        .prev-btn:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }

        .next-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .next-btn:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        /* Background changer */
        .bg-changer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 30px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .bg-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .bg-option:hover {
            transform: scale(1.1);
        }

        .bg-option.selected {
            border: 2px solid var(--dark-color);
            transform: scale(1.1);
        }

        /* Meme navigation */
        .meme-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Loading indicator */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .editor-container {
                flex-direction: column;
            }
            
            .template-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .emoji-picker {
                grid-template-columns: repeat(5, 1fr);
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            nav ul {
                margin-top: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }

            nav ul li {
                margin: 5px 10px;
            }

            .bg-changer {
                bottom: 10px;
                right: 10px;
                flex-wrap: wrap;
                max-width: 150px;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .emoji-picker {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Impact&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="loading">
        <div class="spinner"></div>
    </div>

    <header>
        <div class="header-content">
            <h1>Ultimate Meme Generator</h1>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="editor">Create Meme</a></li>
                    <li><a href="#" class="nav-link" data-page="gallery">My Memes</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Home Page -->
        <div class="page active" id="home-page">
            <div class="home-page">
                <h2>Create Hilarious Memes with Emojis</h2>
                <p>Welcome to the Ultimate Meme Generator! Create, customize, and share your favorite memes with our easy-to-use tool. Choose from popular templates or upload your own images, add text and emojis, and generate memes that will make everyone laugh.</p>
                <button class="get-started-btn">Get Started Now</button>
            </div>
        </div>

        <!-- Editor Page -->
        <div class="page" id="editor-page">
            <h1>Meme Creator</h1>
            
            <div class="editor-container">
                <div class="meme-canvas-container">
                    <canvas id="memeCanvas"></canvas>
                    <div class="canvas-controls">
                        <input type="file" id="imageUpload" accept="image/*">
                        <button id="addTopText">Add Top Text</button>
                        <button id="addBottomText">Add Bottom Text</button>
                        <button id="addCustomText">Add Custom Text</button>
                        <button id="generateMeme" class="generate-meme-btn">Generate Meme</button>
                        <button id="downloadMeme">Download Meme</button>
                        <button id="saveMeme">Save to Gallery</button>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="text-controls">
                        <h3>Text Controls</h3>
                        <div class="form-group">
                            <label for="textContent">Text:</label>
                            <div style="display: flex;">
                                <input type="text" id="textContent" placeholder="Enter meme text">
                                <button id="openEmojiPicker" style="margin-left: 10px; padding: 0 10px;">😀</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="textColor">Color:</label>
                            <input type="color" id="textColor" value="#ffffff">
                        </div>
                        <div class="form-group">
                            <label for="fontSize">Font Size:</label>
                            <input type="range" id="fontSize" min="10" max="100" value="40">
                            <span id="fontSizeValue">40px</span>
                        </div>
                        <div class="form-group">
                            <label for="fontFamily">Font:</label>
                            <select id="fontFamily">
                                <option value="Impact">Impact (Classic Meme)</option>
                                <option value="Arial">Arial</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Comic Sans MS">Comic Sans</option>
                                <option value="Courier New">Courier New</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="textStrokeColor">Stroke Color:</label>
                            <input type="color" id="textStrokeColor" value="#000000">
                        </div>
                        <div class="form-group">
                            <label for="textStrokeWidth">Stroke Width:</label>
                            <input type="range" id="textStrokeWidth" min="0" max="10" value="2">
                            <span id="strokeWidthValue">2px</span>
                        </div>
                        <div class="form-group">
                            <label for="textAlignment">Alignment:</label>
                            <select id="textAlignment">
                                <option value="center">Center</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                            </select>
                        </div>
                        <button id="applyTextChanges">Apply Changes</button>
                        <button id="removeSelectedText">Remove Selected Text</button>
                    </div>
                    
                    <div class="emoji-controls" id="emojiControls" style="display: none;">
                        <h3>Emoji Picker</h3>
                        <div class="emoji-picker" id="emojiPicker">
                            <!-- Emojis will be added here by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="meme-templates">
                        <h3>Popular Templates</h3>
                        <div class="template-grid">
                            <img src="https://i.imgflip.com/1bij.jpg" alt="One Does Not Simply" class="template" data-src="https://i.imgflip.com/1bij.jpg">
                            <img src="https://i.imgflip.com/1g8my.jpg" alt="Distracted Boyfriend" class="template" data-src="https://i.imgflip.com/1g8my.jpg">
                            <img src="https://i.imgflip.com/9vct.jpg" alt="Drake Hotline Bling" class="template" data-src="https://i.imgflip.com/9vct.jpg">
                            <img src="https://i.imgflip.com/1h7in3.jpg" alt="Two Buttons" class="template" data-src="https://i.imgflip.com/1h7in3.jpg">
                            <img src="https://i.imgflip.com/1ihzfe.jpg" alt="Batman Slapping Robin" class="template" data-src="https://i.imgflip.com/1ihzfe.jpg">
                            <img src="https://i.imgflip.com/1i00pm.jpg" alt="X All The Y" class="template" data-src="https://i.imgflip.com/1i00pm.jpg">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Page -->
        <div class="page" id="gallery-page">
            <h1>My Saved Memes</h1>
            <div class="gallery" id="memeGallery">
                <!-- Memes will be loaded here -->
            </div>
            <div class="meme-navigation" id="memeNavigation" style="display: none;">
                <button class="nav-btn prev-btn" id="prevMeme">Previous Meme</button>
                <button class="nav-btn next-btn" id="nextMeme">Next Meme</button>
            </div>
        </div>
    </div>

    <!-- Background Color Changer -->
    <div class="bg-changer">
        <div class="bg-option selected" style="background-color: #f5f5f5;" data-color="#f5f5f5"></div>
        <div class="bg-option" style="background-color: #e8f4f8;" data-color="#e8f4f8"></div>
        <div class="bg-option" style="background-color: #f8f1e8;" data-color="#f8f1e8"></div>
        <div class="bg-option" style="background-color: #e8f8ee;" data-color="#e8f8ee"></div>
        <div class="bg-option" style="background-color: #f8e8f1;" data-color="#f8e8f1"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simulated database for saved memes
            let memeDatabase = JSON.parse(localStorage.getItem('memeDatabase')) || [];
            let currentMemeIndex = 0;
            let currentViewingMemeIndex = 0;

            // Canvas setup
            const canvas = document.getElementById('memeCanvas');
            const ctx = canvas.getContext('2d');
            let canvasWidth = 600;
            let canvasHeight = 600;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // Meme data
            let meme = {
                image: null,
                texts: []
            };
            
            // Selected text index
            let selectedTextIndex = -1;
            let isDragging = false;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            
            // DOM elements
            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('.nav-link');
            const homePage = document.getElementById('home-page');
            const editorPage = document.getElementById('editor-page');
            const galleryPage = document.getElementById('gallery-page');
            const memeGallery = document.getElementById('memeGallery');
            const memeNavigation = document.getElementById('memeNavigation');
            const getStartedBtn = document.querySelector('.get-started-btn');
            const imageUpload = document.getElementById('imageUpload');
            const addTopTextBtn = document.getElementById('addTopText');
            const addBottomTextBtn = document.getElementById('addBottomText');
            const addCustomTextBtn = document.getElementById('addCustomText');
            const generateMemeBtn = document.getElementById('generateMeme');
            const downloadMemeBtn = document.getElementById('downloadMeme');
            const saveMemeBtn = document.getElementById('saveMeme');
            const prevMemeBtn = document.getElementById('prevMeme');
            const nextMemeBtn = document.getElementById('nextMeme');
            const textContent = document.getElementById('textContent');
            const textColor = document.getElementById('textColor');
            const fontSize = document.getElementById('fontSize');
            const fontSizeValue = document.getElementById('fontSizeValue');
            const fontFamily = document.getElementById('fontFamily');
            const textStrokeColor = document.getElementById('textStrokeColor');
            const textStrokeWidth = document.getElementById('textStrokeWidth');
            const strokeWidthValue = document.getElementById('strokeWidthValue');
            const textAlignment = document.getElementById('textAlignment');
            const applyTextChangesBtn = document.getElementById('applyTextChanges');
            const removeSelectedTextBtn = document.getElementById('removeSelectedText');
            const templates = document.querySelectorAll('.template');
            const bgOptions = document.querySelectorAll('.bg-option');
            const loading = document.querySelector('.loading');
            const openEmojiPickerBtn = document.getElementById('openEmojiPicker');
            const emojiControls = document.getElementById('emojiControls');
            const emojiPicker = document.getElementById('emojiPicker');

            // Popular emojis for the picker
            const emojis = [
                '😂', '🤣', '😊', '😍', '😎', '😘', '😁', '😆', '😅', '😄',
                '😃', '😀', '😉', '😋', '😜', '😝', '🤪', '😇', '🥰', '🤗',
                '🤩', '🤔', '😏', '😒', '🙄', '😬', '😴', '😷', '🤒', '🤕',
                '🤢', '🤮', '🤧', '😈', '👿', '👹', '👺', '💀', '👻', '👽',
                '🤖', '💩', '😺', '😸', '😹', '😻', '😼', '😽', '🙀', '😿',
                '😾', '🙈', '🙉', '🙊', '💋', '💌', '💘', '💝', '💖', '💗',
                '💓', '💞', '💕', '💟', '❣️', '💔', '❤️', '🧡', '💛', '💚',
                '💙', '💜', '🤎', '🖤', '🤍', '💯', '💢', '💥', '💫', '💦',
                '💨', '🕳️', '💣', '💬', '👁️‍🗨️', '🗨️', '🗯️', '💭', '💤', '👋',
                '🤚', '🖐️', '✋', '🖖', '👌', '🤏', '✌️', '🤞', '🤟', '🤘',
                '🤙', '👈', '👉', '👆', '🖕', '👇', '☝️', '👍', '👎', '✊',
                '👊', '🤛', '🤜', '👏', '🙌', '👐', '🤲', '🤝', '🙏', '✍️',
                '💅', '🤳', '💪', '🦾', '🦿', '🦵', '🦶', '👂', '🦻', '👃',
                '🧠', '🦷', '🦴', '👀', '👁️', '👅', '👄', '👶', '🧒', '👦',
                '👧', '🧑', '👱', '👨', '🧔', '👨‍🦰', '👨‍🦱', '👨‍🦳', '👨‍🦲', '👩',
                '👩‍🦰', '👩‍🦱', '👩‍🦳', '👩‍🦲', '🧓', '👴', '👵', '🙍', '🙍‍♂️', '🙍‍♀️',
                '🙎', '🙎‍♂️', '🙎‍♀️', '🙅', '🙅‍♂️', '🙅‍♀️', '🙆', '🙆‍♂️', '🙆‍♀️', '💁',
                '💁‍♂️', '💁‍♀️', '🙋', '🙋‍♂️', '🙋‍♀️', '🧏', '🧏‍♂️', '🧏‍♀️', '🙇', '🙇‍♂️',
                '🙇‍♀️', '🤦', '🤦‍♂️', '🤦‍♀️', '🤷', '🤷‍♂️', '🤷‍♀️', '👨‍⚕️', '👩‍⚕️', '👨‍🎓',
                '👩‍🎓', '👨‍🏫', '👩‍🏫', '👨‍⚖️', '👩‍⚖️', '👨‍🌾', '👩‍🌾', '👨‍🍳', '👩‍🍳', '👨‍🔧',
                '👩‍🔧', '👨‍🏭', '👩‍🏭', '👨‍💼', '👩‍💼', '👨‍🔬', '👩‍🔬', '👨‍💻', '👩‍💻', '👨‍🎤',
                '👩‍🎤', '👨‍🎨', '👩‍🎨', '👨‍✈️', '👩‍✈️', '👨‍🚀', '👩‍🚀', '👨‍🚒', '👩‍🚒', '👮',
                '👮‍♂️', '👮‍♀️', '🕵️', '🕵️‍♂️', '🕵️‍♀️', '💂', '💂‍♂️', '💂‍♀️', '👷', '👷‍♂️',
                '👷‍♀️', '🤴', '👸', '👳', '👳‍♂️', '👳‍♀️', '👲', '🧕', '🤵', '🤵‍♂️',
                '🤵‍♀️', '👰', '👰‍♂️', '👰‍♀️', '🤰', '🤱', '👼', '🎅', '🤶', '🧙',
                '🧙‍♂️', '🧙‍♀️', '🧚', '🧚‍♂️', '🧚‍♀️', '🧛', '🧛‍♂️', '🧛‍♀️', '🧜', '🧜‍♂️',
                '🧜‍♀️', '🧝', '🧝‍♂️', '🧝‍♀️', '🧞', '🧞‍♂️', '🧞‍♀️', '🧟', '🧟‍♂️', '🧟‍♀️',
                '💆', '💆‍♂️', '💆‍♀️', '💇', '💇‍♂️', '💇‍♀️', '🚶', '🚶‍♂️', '🚶‍♀️', '🧍',
                '🧍‍♂️', '🧍‍♀️', '🧎', '🧎‍♂️', '🧎‍♀️', '👨‍🦯', '👩‍🦯', '👨‍🦼', '👩‍🦼', '👨‍🦽',
                '👩‍🦽', '🏃', '🏃‍♂️', '🏃‍♀️', '💃', '🕺', '🕴️', '👯', '👯‍♂️', '👯‍♀️',
                '🧖', '🧖‍♂️', '🧖‍♀️', '🧗', '🧗‍♂️', '🧗‍♀️', '🤺', '🏇', '⛷️', '🏂',
                '🏌️', '🏌️‍♂️', '🏌️‍♀️', '🏄', '🏄‍♂️', '🏄‍♀️', '🚣', '🚣‍♂️', '🚣‍♀️', '🏊',
                '🏊‍♂️', '🏊‍♀️', '⛹️', '⛹️‍♂️', '⛹️‍♀️', '🏋️', '🏋️‍♂️', '🏋️‍♀️', '🚴', '🚴‍♂️',
                '🚴‍♀️', '🚵', '🚵‍♂️', '🚵‍♀️', '🤸', '🤸‍♂️', '🤸‍♀️', '🤽', '🤽‍♂️', '🤽‍♀️',
                '🤾', '🤾‍♂️', '🤾‍♀️', '🤹', '🤹‍♂️', '🤹‍♀️', '🧘', '🧘‍♂️', '🧘‍♀️', '🛀',
                '🛌', '🧑‍🤝‍🧑', '👭', '👫', '👬', '💏', '💑', '👪', '🗣️', '👤',
                '👥', '🫂', '👣', '🦰', '🦱', '🦳', '🦲', '🐵', '🐒', '🦍',
                '🦧', '🐶', '🐕', '🦮', '🐕‍🦺', '🐩', '🐺', '🦊', '🦝', '🐱',
                '🐈', '🐈‍⬛', '🦁', '🐯', '🐅', '🐆', '🐴', '🐎', '🦄', '🦓',
                '🦌', '🦬', '🐮', '🐂', '🐃', '🐄', '🐷', '🐖', '🐗', '🐽',
                '🐏', '🐑', '🐐', '🐪', '🐫', '🦙', '🦒', '🐘', '🦣', '🦏',
                '🦛', '🐭', '🐁', '🐀', '🐹', '🐰', '🐇', '🐿️', '🦫', '🦔',
                '🦇', '🐻', '🐻‍❄️', '🐨', '🐼', '🦥', '🦦', '🦨', '🦘', '🦡',
                '🐾', '🦃', '🐔', '🐓', '🐣', '🐤', '🐥', '🐦', '🐧', '🕊️',
                '🦅', '🦆', '🦢', '🦉', '🦤', '🪶', '🦩', '🦚', '🦜', '🐸',
                '🐊', '🐢', '🦎', '🐍', '🐲', '🐉', '🦕', '🦖', '🐳', '🐋',
                '🐬', '🦭', '🐟', '🐠', '🐡', '🦈', '🐙', '🐚', '🐌', '🦋',
                '🐛', '🐜', '🐝', '🪲', '🐞', '🦗', '🪳', '🕷️', '🕸️', '🦂',
                '🦟', '🪰', '🪱', '🦠', '💐', '🌸', '💮', '🏵️', '🌹', '🥀',
                '🌺', '🌻', '🌼', '🌷', '🌱', '🪴', '🌲', '🌳', '🌴', '🌵',
                '🌾', '🌿', '☘️', '🍀', '🍁', '🍂', '🍃', '🍇', '🍈', '🍉',
                '🍊', '🍋', '🍌', '🍍', '🥭', '🍎', '🍏', '🍐', '🍑', '🍒',
                '🍓', '🫐', '🥝', '🍅', '🫒', '🥥', '🥑', '🍆', '🥔', '🥕',
                '🌽', '🌶️', '🫑', '🥒', '🥬', '🥦', '🧄', '🧅', '🍄', '🥜',
                '🫘', '🌰', '🍞', '🥐', '🥖', '🫓', '🥨', '🥯', '🥞', '🧇',
                '🧀', '🍖', '🍗', '🥩', '🥓', '🍔', '🍟', '🍕', '🌭', '🥪',
                '🌮', '🌯', '🫔', '🥙', '🧆', '🥚', '🍳', '🥘', '🍲', '🫕',
                '🥣', '🥗', '🍿', '🧈', '🧂', '🥫', '🍱', '🍘', '🍙', '🍚',
                '🍛', '🍜', '🍝', '🍠', '🍢', '🍣', '🍤', '🍥', '🥮', '🍡',
                '🥟', '🥠', '🥡', '🦀', '🦞', '🦐', '🦑', '🦪', '🍦', '🍧',
                '🍨', '🍩', '🍪', '🎂', '🍰', '🧁', '🥧', '🍫', '🍬', '🍭',
                '🍮', '🍯', '🍼', '🥛', '☕', '🫖', '🍵', '🍶', '🍾', '🍷',
                '🍸', '🍹', '🍺', '🍻', '🥂', '🥃', '🥤', '🧋', '🧃', '🧉',
                '🧊', '🥢', '🍽️', '🍴', '🥄', '🔪', '🏺', '🌍', '🌎', '🌏',
                '🌐', '🗺️', '🗾', '🧭', '🏔️', '⛰️', '🌋', '🗻', '🏕️', '🏖️',
                '🏜️', '🏝️', '🏞️', '🏟️', '🏛️', '🏗️', '🧱', '🪨', '🪵', '🛖',
                '🏘️', '🏚️', '🏠', '🏡', '🏢', '🏣', '🏤', '🏥', '🏦', '🏨',
                '🏩', '🏪', '🏫', '🏬', '🏭', '🏯', '🏰', '💒', '🗼', '🗽',
                '⛪', '🕌', '🛕', '🕍', '⛩️', '🕋', '⛲', '⛺', '🌁', '🌃',
                '🏙️', '🌄', '🌅', '🌆', '🌇', '🌉', '♨️', '🎠', '🎡', '🎢',
                '💈', '🎪', '🚂', '🚃', '🚄', '🚅', '🚆', '🚇', '🚈', '🚉',
                '🚊', '🚝', '🚞', '🚋', '🚌', '🚍', '🚎', '🚐', '🚑', '🚒',
                '🚓', '🚔', '🚕', '🚖', '🚗', '🚘', '🚙', '🚚', '🚛', '🚜',
                '🏎️', '🏍️', '🛵', '🦽', '🦼', '🛺', '🚲', '🛴', '🛹', '🛼',
                '🚏', '🛣️', '🛤️', '🛢️', '⛽', '🚨', '🚥', '🚦', '🛑', '🚧',
                '⚓', '⛵', '🛶', '🚤', '🛳️', '⛴️', '🛥️', '🚢', '✈️', '🛩️',
                '🛫', '🛬', '🪂', '💺', '🚁', '🚟', '🚠', '🚡', '🛰️', '🚀',
                '🛸', '🛎️', '🧳', '⌛', '⏳', '⌚', '⏰', '⏱️', '⏲️', '🕰️',
                '🕛', '🕧', '🕐', '🕜', '🕑', '🕝', '🕒', '🕞', '🕓', '🕟',
                '🕔', '🕠', '🕕', '🕡', '🕖', '🕢', '🕗', '🕣', '🕘', '🕤',
                '🕙', '🕥', '🕚', '🕦', '🌑', '🌒', '🌓', '🌔', '🌕', '🌖',
                '🌗', '🌘', '🌙', '🌚', '🌛', '🌜', '🌡️', '☀️', '🌝', '🌞',
                '🪐', '⭐', '🌟', '🌠', '🌌', '☁️', '⛅', '⛈️', '🌤️', '🌥️',
                '🌦️', '🌧️', '🌨️', '🌩️', '🌪️', '🌫️', '🌬️', '🌀', '🌈', '🌂',
                '☂️', '☔', '⛱️', '⚡', '❄️', '☃️', '⛄', '☄️', '🔥', '💧',
                '🌊', '🎃', '🎄', '🎆', '🎇', '🧨', '✨', '🎈', '🎉', '🎊',
                '🎋', '🎍', '🎎', '🎏', '🎐', '🎑', '🧧', '🎀', '🎁', '🎗️',
                '🎟️', '🎫', '🎖️', '🏆', '🏅', '🥇', '🥈', '🥉', '⚽', '⚾',
                '🥎', '🏀', '🏐', '🏈', '🏉', '🎾', '🥏', '🎳', '🏏', '🏑',
                '🏒', '🥍', '🏓', '🏸', '🥊', '🥋', '🥅', '⛳', '🪁', '🏹',
                '🎣', '🤿', '🛝', '🎽', '🎿', '🛷', '🥌', '🎯', '🪀', '🪁',
                '🎱', '🔮', '🪄', '🧿', '🎮', '🕹️', '🎰', '🎲', '🧩', '🧸',
                '🪅', '🪆', '♠️', '♥️', '♦️', '♣️', '♟️', '🃏', '🀄', '🎴',
                '🎭', '🖼️', '🎨', '🧵', '🪡', '🧶', '🪢', '👓', '🕶️', '🥽',
                '🥼', '🦺', '👔', '👕', '👖', '🧣', '🧤', '🧥', '🧦', '👗',
                '👘', '🥻', '🩱', '🩲', '🩳', '👙', '👚', '👛', '👜', '👝',
                '🛍️', '🎒', '🩴', '👞', '👟', '🥾', '🥿', '👠', '👡', '🩰',
                '👢', '👑', '👒', '🎩', '🎓', '🧢', '🪖', '⛑️', '📿', '💄',
                '💍', '💎', '🔇', '🔈', '🔉', '🔊', '📢', '📣', '📯', '🔔',
                '🔕', '🎼', '🎵', '🎶', '🎙️', '🎚️', '🎛️', '🎤', '🎧', '📻',
                '🎷', '🪗', '🎸', '🎹', '🎺', '🎻', '🪕', '🥁', '🪘', '📱',
                '📲', '☎️', '📞', '📟', '📠', '🔋', '🔌', '💻', '🖥️', '🖨️',
                '⌨️', '🖱️', '🖲️', '💽', '💾', '💿', '📀', '🧮', '🎥', '🎞️',
                '📽️', '🎬', '📺', '📷', '📸', '📹', '📼', '🔍', '🔎', '🕯️',
                '💡', '🔦', '🏮', '🪔', '📔', '📕', '📖', '📗', '📘', '📙',
                '📚', '📓', '📒', '📃', '📜', '📄', '📰', '🗞️', '📑', '🔖',
                '🏷️', '💰', '🪙', '💴', '💵', '💶', '💷', '💸', '💳', '🧾',
                '💹', '✉️', '📧', '📨', '📩', '📤', '📥', '📦', '📫', '📪',
                '📬', '📭', '📮', '🗳️', '✏️', '✒️', '🖋️', '🖊️', '🖌️', '🖍️',
                '📝', '💼', '📁', '📂', '🗂️', '📅', '📆', '🗒️', '🗓️', '📇',
                '📈', '📉', '📊', '📋', '📌', '📍', '📎', '🖇️', '📏', '📐',
                '✂️', '🗃️', '🗄️', '🗑️', '🔒', '🔓', '🔏', '🔐', '🔑', '🗝️',
                '🔨', '🪓', '⛏️', '⚒️', '🛠️', '🗡️', '⚔️', '🔫', '🪃', '🏹',
                '🛡️', '🪚', '🔧', '🪛', '🔩', '⚙️', '🗜️', '⚖️', '🦯', '🔗',
                '⛓️', '🪝', '🧰', '🧲', '🪜', '⚗️', '🧪', '🧫', '🧬', '🔬',
                '🔭', '📡', '💉', '🩸', '💊', '🩹', '🩺', '🚪', '🛗', '🪞',
                '🪟', '🛏️', '🛋️', '🪑', '🚽', '🪠', '🚿', '🛁', '🪤', '🪒',
                '🧴', '🧷', '🧹', '🧺', '🧻', '🪣', '🧼', '🪥', '🧽', '🧯',
                '🛒', '🚬', '⚰️', '🪦', '⚱️', '🗿', '🪧', '🏧', '🚮', '🚰',
                '♿', '🚹', '🚺', '🚻', '🚼', '🚾', '🛂', '🛃', '🛄', '🛅',
                '⚠️', '🚸', '⛔', '🚫', '🚳', '🚭', '🚯', '🚱', '🚷', '📵',
                '🔞', '☢️', '☣️', '⬆️', '↗️', '➡️', '↘️', '⬇️', '↙️', '⬅️',
                '↖️', '↕️', '↔️', '↩️', '↪️', '⤴️', '⤵️', '🔃', '🔄', '🔙',
                '🔚', '🔛', '🔜', '🔝', '🛐', '⚛️', '🕉️', '✡️', '☸️', '☯️',
                '✝️', '☦️', '☪️', '☮️', '🕎', '🔯', '♈', '♉', '♊', '♋',
                '♌', '♍', '♎', '♏', '♐', '♑', '♒', '♓', '⛎', '🔀',
                '🔁', '🔂', '▶️', '⏩', '⏭️', '⏯️', '◀️', '⏪', '⏮️', '🔼',
                '⏫', '🔽', '⏬', '⏸️', '⏹️', '⏺️', '⏏️', '🎦', '🔅', '🔆',
                '📶', '📳', '📴', '♀️', '♂️', '⚧️', '✖️', '➕', '➖', '➗',
                '♾️', '‼️', '⁉️', '❓', '❔', '❕', '❗', '〰️', '💠', '🔘',
                '🔳', '🔲', '🏁', '🚩', '🏴', '🏳️', '🏳️‍🌈', '🏳️‍⚧️', '🏴‍☠️', '🇦🇨',
                '🇦🇩', '🇦🇪', '🇦🇫', '🇦🇬', '🇦🇮', '🇦🇱', '🇦🇲', '🇦🇴', '🇦🇶', '🇦🇷',
                '🇦🇸', '🇦🇹', '🇦🇺', '🇦🇼', '🇦🇽', '🇦🇿', '🇧🇦', '🇧🇧', '🇧🇩', '🇧🇪',
                '🇧🇫', '🇧🇬', '🇧🇭', '🇧🇮', '🇧🇯', '🇧🇱', '🇧🇲', '🇧🇳', '🇧🇴', '🇧🇶',
                '🇧🇷', '🇧🇸', '🇧🇹', '🇧🇻', '🇧🇼', '🇧🇾', '🇧🇿', '🇨🇦', '🇨🇨', '🇨🇩',
                '🇨🇫', '🇨🇬', '🇨🇭', '🇨🇮', '🇨🇰', '🇨🇱', '🇨🇲', '🇨🇳', '🇨🇴', '🇨🇵',
                '🇨🇷', '🇨🇺', '🇨🇻', '🇨🇼', '🇨🇽', '🇨🇾', '🇨🇿', '🇩🇪', '🇩🇬', '🇩🇯',
                '🇩🇰', '🇩🇲', '🇩🇴', '🇩🇿', '🇪🇦', '🇪🇨', '🇪🇪', '🇪🇬', '🇪🇭', '🇪🇷',
                '🇪🇸', '🇪🇹', '🇪🇺', '🇫🇮', '🇫🇯', '🇫🇰', '🇫🇲', '🇫🇴', '🇫🇷', '🇬🇦',
                '🇬🇧', '🇬🇩', '🇬🇪', '🇬🇫', '🇬🇬', '🇬🇭', '🇬🇮', '🇬🇱', '🇬🇲', '🇬🇳',
                '🇬🇵', '🇬🇶', '🇬🇷', '🇬🇸', '🇬🇹', '🇬🇺', '🇬🇼', '🇬🇾', '🇭🇰', '🇭🇲',
                '🇭🇳', '🇭🇷', '🇭🇹', '🇭🇺', '🇮🇨', '🇮🇩', '🇮🇪', '🇮🇱', '🇮🇲', '🇮🇳',
                '🇮🇴', '🇮🇶', '🇮🇷', '🇮🇸', '🇮🇹', '🇯🇪', '🇯🇲', '🇯🇴', '🇯🇵', '🇰🇪',
                '🇰🇬', '🇰🇭', '🇰🇮', '🇰🇲', '🇰🇳', '🇰🇵', '🇰🇷', '🇰🇼', '🇰🇾', '🇰🇿',
                '🇱🇦', '🇱🇧', '🇱🇨', '🇱🇮', '🇱🇰', '🇱🇷', '🇱🇸', '🇱🇹', '🇱🇺', '🇱🇻',
                '🇱🇾', '🇲🇦', '🇲🇨', '🇲🇩', '🇲🇪', '🇲🇫', '🇲🇬', '🇲🇭', '🇲🇰', '🇲🇱',
                '🇲🇲', '🇲🇳', '🇲🇴', '🇲🇵', '🇲🇶', '🇲🇷', '🇲🇸', '🇲🇹', '🇲🇺', '🇲🇻',
                '🇲🇼', '🇲🇽', '🇲🇾', '🇲🇿', '🇳🇦', '🇳🇨', '🇳🇪', '🇳🇫', '🇳🇬', '🇳🇮',
                '🇳🇱', '🇳🇴', '🇳🇵', '🇳🇷', '🇳🇺', '🇳🇿', '🇴🇲', '🇵🇦', '🇵🇪', '🇵🇫',
                '🇵🇬', '🇵🇭', '🇵🇰', '🇵🇱', '🇵🇲', '🇵🇳', '🇵🇷', '🇵🇸', '🇵🇹', '🇵🇼',
                '🇵🇾', '🇶🇦', '🇷🇪', '🇷🇴', '🇷🇸', '🇷🇺', '🇷🇼', '🇸🇦', '🇸🇧', '🇸🇨',
                '🇸🇩', '🇸🇪', '🇸🇬', '🇸🇭', '🇸🇮', '🇸🇯', '🇸🇰', '🇸🇱', '🇸🇲', '🇸🇳',
                '🇸🇴', '🇸🇷', '🇸🇸', '🇸🇹', '🇸🇻', '🇸🇽', '🇸🇾', '🇸🇿', '🇹🇦', '🇹🇨',
                '🇹🇩', '🇹🇫', '🇹🇬', '🇹🇭', '🇹🇯', '🇹🇰', '🇹🇱', '🇹🇲', '🇹🇳', '🇹🇴',
                '🇹🇷', '🇹🇹', '🇹🇻', '🇹🇼', '🇹🇿', '🇺🇦', '🇺🇬', '🇺🇲', '🇺🇳', '🇺🇸',
                '🇺🇾', '🇺🇿', '🇻🇦', '🇻🇨', '🇻🇪', '🇻🇬', '🇻🇮', '🇻🇳', '🇻🇺', '🇼🇫',
                '🇼🇸', '🇽🇰', '🇾🇪', '🇾🇹', '🇿🇦', '🇿🇲', '🇿🇼', '🏴󠁧󠁢󠁥󠁮󠁧󠁿', '🏴󠁧󠁢󠁳󠁣󠁴󠁿', '🏴󠁧󠁢󠁷󠁬󠁳󠁿'
            ];

            // Initialize emoji picker
            function initEmojiPicker() {
                emojis.forEach(emoji => {
                    const btn = document.createElement('button');
                    btn.className = 'emoji-btn';
                    btn.textContent = emoji;
                    btn.addEventListener('click', () => {
                        const textInput = document.getElementById('textContent');
                        textInput.value += emoji;
                        textInput.focus();
                    });
                    emojiPicker.appendChild(btn);
                });
            }

            initEmojiPicker();

            // Toggle emoji picker
            openEmojiPickerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                emojiControls.style.display = emojiControls.style.display === 'none' ? 'block' : 'none';
            });

            // Functions
            function navigateToPage(e) {
                const pageId = e.target.dataset.page;
                
                // Update active nav link
                navLinks.forEach(link => link.classList.remove('active'));
                e.target.classList.add('active');
                
                // Show selected page
                pages.forEach(page => page.classList.remove('active'));
                document.getElementById(`${pageId}-page`).classList.add('active');
                
                // Load gallery if needed
                if (pageId === 'gallery') {
                    loadGallery();
                }
            }
            
            function handleImageUpload(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                showLoading();
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        // Calculate dimensions to maintain aspect ratio
                        const ratio = Math.min(canvasWidth / img.width, canvasHeight / img.height);
                        const newWidth = img.width * ratio;
                        const newHeight = img.height * ratio;
                        
                        // Update canvas dimensions
                        canvas.width = newWidth;
                        canvas.height = newHeight;
                        canvasWidth = newWidth;
                        canvasHeight = newHeight;
                        
                        // Set meme image
                        meme.image = img;
                        meme.texts = []; // Clear existing texts
                        selectedTextIndex = -1;
                        drawCanvas();
                        hideLoading();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            function loadTemplate(url) {
                showLoading();
                
                const img = new Image();
                img.crossOrigin = 'Anonymous'; // For CORS enabled images
                img.onload = function() {
                    // Calculate dimensions to maintain aspect ratio
                    const ratio = Math.min(canvasWidth / img.width, canvasHeight / img.height);
                    const newWidth = img.width * ratio;
                    const newHeight = img.height * ratio;
                    
                    // Update canvas dimensions
                    canvas.width = newWidth;
                    canvas.height = newHeight;
                    canvasWidth = newWidth;
                    canvasHeight = newHeight;
                    
                    // Set meme image
                    meme.image = img;
                    meme.texts = []; // Clear existing texts
                    selectedTextIndex = -1;
                    drawCanvas();
                    hideLoading();
                };
                img.onerror = function() {
                    alert('Error loading template. Please try another one.');
                    hideLoading();
                };
                img.src = url;
            }
            
            function addText(position) {
                let textObj;
                
                switch(position) {
                    case 'top':
                        textObj = {
                            content: 'TOP TEXT 😂',
                            color: '#ffffff',
                            fontSize: 40,
                            fontFamily: 'Impact',
                            strokeColor: '#000000',
                            strokeWidth: 2,
                            alignment: 'center',
                            x: canvasWidth / 2,
                            y: 50,
                            position: position
                        };
                        break;
                    case 'bottom':
                        textObj = {
                            content: 'BOTTOM TEXT 🤣',
                            color: '#ffffff',
                            fontSize: 40,
                            fontFamily: 'Impact',
                            strokeColor: '#000000',
                            strokeWidth: 2,
                            alignment: 'center',
                            x: canvasWidth / 2,
                            y: canvasHeight - 30,
                            position: position
                        };
                        break;
                    case 'custom':
                    default:
                        textObj = {
                            content: 'DRAG ME 😊',
                            color: '#ffffff',
                            fontSize: 40,
                            fontFamily: 'Impact',
                            strokeColor: '#000000',
                            strokeWidth: 2,
                            alignment: 'center',
                            x: canvasWidth / 2,
                            y: canvasHeight / 2,
                            position: 'custom'
                        };
                        break;
                }
                
                meme.texts.push(textObj);
                selectedTextIndex = meme.texts.length - 1;
                updateControlsWithSelectedText();
                drawCanvas();
            }
            
            function drawCanvas() {
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw image if exists
                if (meme.image) {
                    ctx.drawImage(meme.image, 0, 0, canvas.width, canvas.height);
                } else {
                    // Draw placeholder
                    ctx.fillStyle = '#f9f9f9';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#ccc';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Upload an image or select a template', canvas.width / 2, canvas.height / 2);
                }
                
                // Draw texts
                meme.texts.forEach((text, index) => {
                    drawText(text, index === selectedTextIndex);
                });
            }
            
            function drawText(text, isSelected) {
                ctx.font = `${text.fontSize}px ${text.fontFamily}`;
                ctx.textAlign = text.alignment;
                
                // Calculate text position based on alignment
                let x = text.x;
                let y = text.y;
                
                // Draw stroke (outline)
                ctx.strokeStyle = text.strokeColor;
                ctx.lineWidth = text.strokeWidth;
                ctx.strokeText(text.content, x, y);
                
                // Draw text
                ctx.fillStyle = text.color;
                ctx.fillText(text.content, x, y);
                
                // Draw selection indicator
                if (isSelected) {
                    const textMetrics = ctx.measureText(text.content);
                    const textWidth = textMetrics.width;
                    const textHeight = text.fontSize;
                    
                    let rectX;
                    if (text.alignment === 'center') {
                        rectX = x - textWidth / 2;
                    } else if (text.alignment === 'left') {
                        rectX = x;
                    } else { // right
                        rectX = x - textWidth;
                    }
                    
                    ctx.strokeStyle = '#3498db';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.strokeRect(rectX - 5, y - textHeight + 5, textWidth + 10, textHeight + 10);
                    ctx.setLineDash([]);
                }
            }
            
            function handleCanvasMouseDown(e) {
                if (!meme.image) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Check if clicked on a text element
                for (let i = meme.texts.length - 1; i >= 0; i--) {
                    const text = meme.texts[i];
                    ctx.font = `${text.fontSize}px ${text.fontFamily}`;
                    const textMetrics = ctx.measureText(text.content);
                    const textWidth = textMetrics.width;
                    const textHeight = text.fontSize;
                    
                    let textX = text.x;
                    
                    let rectX;
                    if (text.alignment === 'center') {
                        rectX = textX - textWidth / 2;
                    } else if (text.alignment === 'left') {
                        rectX = textX;
                    } else { // right
                        rectX = textX - textWidth;
                    }
                    
                    const rectY = text.y - textHeight;
                    
                    if (x >= rectX - 5 && 
                        x <= rectX + textWidth + 5 && 
                        y >= rectY - 5 && 
                        y <= rectY + textHeight + 5) {
                        selectedTextIndex = i;
                        isDragging = true;
                        
                        // Calculate offset between mouse and text position
                        dragOffsetX = x - text.x;
                        dragOffsetY = y - text.y;
                        
                        updateControlsWithSelectedText();
                        drawCanvas();
                        return;
                    }
                }
                
                // If clicked outside any text, deselect
                selectedTextIndex = -1;
                isDragging = false;
                clearTextControls();
                drawCanvas();
            }
            
            function handleCanvasMouseMove(e) {
                if (!isDragging || selectedTextIndex === -1) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Update text position
                meme.texts[selectedTextIndex].x = x - dragOffsetX;
                meme.texts[selectedTextIndex].y = y - dragOffsetY;
                
                drawCanvas();
            }
            
            function handleCanvasMouseUp() {
                isDragging = false;
            }
            
            function updateControlsWithSelectedText() {
                if (selectedTextIndex === -1 || selectedTextIndex >= meme.texts.length) {
                    clearTextControls();
                    return;
                }
                
                const text = meme.texts[selectedTextIndex];
                textContent.value = text.content;
                textColor.value = text.color;
                fontSize.value = text.fontSize;
                fontSizeValue.textContent = `${text.fontSize}px`;
                fontFamily.value = text.fontFamily;
                textStrokeColor.value = text.strokeColor;
                textStrokeWidth.value = text.strokeWidth;
                strokeWidthValue.textContent = `${text.strokeWidth}px`;
                textAlignment.value = text.alignment;
            }
            
            function clearTextControls() {
                textContent.value = '';
                textColor.value = '#ffffff';
                fontSize.value = 40;
                fontSizeValue.textContent = '40px';
                fontFamily.value = 'Impact';
                textStrokeColor.value = '#000000';
                textStrokeWidth.value = 2;
                strokeWidthValue.textContent = '2px';
                textAlignment.value = 'center';
            }
            
            function updateFontSizeValue() {
                fontSizeValue.textContent = `${fontSize.value}px`;
            }
            
            function updateStrokeWidthValue() {
                strokeWidthValue.textContent = `${textStrokeWidth.value}px`;
            }
            
            function applyTextChanges() {
                if (selectedTextIndex === -1 || selectedTextIndex >= meme.texts.length) return;
                
                const text = meme.texts[selectedTextIndex];
                text.content = textContent.value;
                text.color = textColor.value;
                text.fontSize = parseInt(fontSize.value);
                text.fontFamily = fontFamily.value;
                text.strokeColor = textStrokeColor.value;
                text.strokeWidth = parseInt(textStrokeWidth.value);
                text.alignment = textAlignment.value;
                
                drawCanvas();
            }
            
            function removeSelectedText() {
                if (selectedTextIndex === -1 || selectedTextIndex >= meme.texts.length) return;
                
                meme.texts.splice(selectedTextIndex, 1);
                selectedTextIndex = -1;
                clearTextControls();
                drawCanvas();
            }
            
            function generateMeme() {
                if (!meme.image && meme.texts.length === 0) {
                    alert('Please add an image and/or text to create a meme');
                    return;
                }
                
                drawCanvas();
                alert('Meme generated! Now you can download or save it.');
            }
            
            function downloadMeme() {
                if (!meme.image && meme.texts.length === 0) {
                    alert('Please add an image and/or text to create a meme');
                    return;
                }
                
                // Create a temporary link
                const link = document.createElement('a');
                link.download = `meme-${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            function saveMeme() {
                if (!meme.image && meme.texts.length === 0) {
                    alert('Please add an image and/or text to create a meme');
                    return;
                }
                
                showLoading();
                
                // Simulate API call with setTimeout
                setTimeout(() => {
                    const memeData = {
                        id: Date.now(),
                        imageData: canvas.toDataURL('image/png'),
                        createdAt: new Date().toISOString(),
                        title: `Meme ${memeDatabase.length + 1}`
                    };
                    
                    // Add to database
                    memeDatabase.push(memeData);
                    localStorage.setItem('memeDatabase', JSON.stringify(memeDatabase));
                    
                    hideLoading();
                    alert('Meme saved to your gallery!');
                    
                    // If on gallery page, refresh
                    if (document.getElementById('gallery-page').classList.contains('active')) {
                        loadGallery();
                    }
                }, 1000);
            }
            
            function loadGallery() {
                memeGallery.innerHTML = '';
                
                if (memeDatabase.length === 0) {
                    memeGallery.innerHTML = '<p>No saved memes yet. Create some memes and save them to see them here!</p>';
                    memeNavigation.style.display = 'none';
                    return;
                }
                
                memeDatabase.forEach((meme, index) => {
                    const memeItem = document.createElement('div');
                    memeItem.className = 'meme-item';
                    memeItem.innerHTML = `
                        <img src="${meme.imageData}" alt="${meme.title}">
                        <div class="meme-item-info">
                            <h3>${meme.title}</h3>
                            <div class="meme-item-actions">
                                <button class="download-btn" data-id="${meme.id}">Download</button>
                                <button class="delete-btn" data-id="${meme.id}">Delete</button>
                            </div>
                        </div>
                    `;
                    memeGallery.appendChild(memeItem);
                });
                
                // Add event listeners to new buttons
                document.querySelectorAll('.download-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const memeId = parseInt(this.dataset.id);
                        downloadSavedMeme(memeId);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const memeId = parseInt(this.dataset.id);
                        deleteMeme(memeId);
                    });
                });
                
                // Show navigation if viewing a single meme
                if (currentViewingMemeIndex >= 0) {
                    memeNavigation.style.display = 'flex';
                } else {
                    memeNavigation.style.display = 'none';
                }
            }
            
            function downloadSavedMeme(memeId) {
                const meme = memeDatabase.find(m => m.id === memeId);
                if (!meme) return;
                
                const link = document.createElement('a');
                link.download = `meme-${memeId}.png`;
                link.href = meme.imageData;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            function deleteMeme(memeId) {
                if (confirm('Are you sure you want to delete this meme?')) {
                    memeDatabase = memeDatabase.filter(m => m.id !== memeId);
                    localStorage.setItem('memeDatabase', JSON.stringify(memeDatabase));
                    loadGallery();
                }
            }
            
            function showPrevMeme() {
                if (currentViewingMemeIndex > 0) {
                    currentViewingMemeIndex--;
                    viewMeme(currentViewingMemeIndex);
                }
            }
            
            function showNextMeme() {
                if (currentViewingMemeIndex < memeDatabase.length - 1) {
                    currentViewingMemeIndex++;
                    viewMeme(currentViewingMemeIndex);
                }
            }
            
            function viewMeme(index) {
                // This would show a larger view of the meme
                // For simplicity, we'll just highlight it in the gallery
                const memeItems = document.querySelectorAll('.meme-item');
                memeItems.forEach((item, i) => {
                    if (i === index) {
                        item.style.border = '2px solid var(--primary-color)';
                    } else {
                        item.style.border = '1px solid #ddd';
                    }
                });
            }
            
            function changeBackgroundColor(color) {
                document.body.style.backgroundColor = color;
            }
            
            function showLoading() {
                loading.classList.add('active');
            }
            
            function hideLoading() {
                loading.classList.remove('active');
            }
        });
    </script>
</body>
</html>